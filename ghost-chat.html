<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GHOST LOUNGE</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡¶æ‡¶¨‡¶≤ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
        .msg-container { margin-bottom: 15px; padding: 10px; border-bottom: 1px solid rgba(255,215,0,0.1); }
        .u-name { color: gold; font-weight: bold; font-size: 14px; text-transform: uppercase; margin-right: 10px; }
        .u-msg { color: #eee; font-family: 'Michroma', sans-serif; font-size: 15px; }
        .u-time { color: #444; font-size: 10px; float: right; }
    </style>
</head>
<body>
    <div style="max-width:1000px; margin:50px auto; background:rgba(0,0,0,0.95); border:2px solid gold; height:85vh; position:relative; display:flex; flex-direction:column; box-shadow: 0 0 50px #000;">
        
        <div style="background:gold; color:black; padding:15px; font-weight:bold; letter-spacing:5px; display:flex; justify-content:space-between;">
            <span>ENCRYPTED CHANNEL: GHOST-LOUNGE</span>
            <span id="liveStatus" style="font-size:12px;">üî¥ LIVE MONITORING</span>
        </div>

        <div id="cBox" style="flex:1; padding:30px; overflow-y:auto; scroll-behavior: smooth;">
            </div>

        <div id="lockMessage" style="text-align:center; padding:20px; background:#111; border-top:1px solid gold;">
            <h3 style="color:gold; margin:0;">üóùÔ∏è SYSTEM LOCKED FOR GUESTS</h3>
            <p style="font-size:11px; opacity:0.5; margin:5px 0;">ONLY REALM OWNERS CAN BROADCAST MESSAGES.</p>
        </div>

        <div id="iArea" style="display:none; padding:30px; border-top:1px solid gold; background:#0a0a0a;">
            <div style="display:flex; gap:15px;">
                <input type="text" id="msgInput" placeholder="Broadcast to the network..." style="flex:1; background:none; border:none; border-bottom:2px solid gold; color:white; padding:10px; outline:none; font-size:16px;">
                <button onclick="sendMsg()" style="background:gold; border:none; padding:10px 40px; cursor:pointer; font-weight:bold; color:black; font-family:'Pirata One'; font-size:20px;">SEND</button>
            </div>
        </div>

        <button onclick="history.back()" style="position:absolute; top:-40px; left:0; background:none; border:none; color:gold; cursor:pointer;">‚Üê BACK TO MAP</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getDatabase, ref, onValue, push, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDmMgjlpXsk0Ip5Frrlifu6bgRJNNIIYzM",
            authDomain: "aether-realms.firebaseapp.com",
            databaseURL: "https://aether-realms-default-rtdb.firebaseio.com",
            projectId: "aether-realms",
            storageBucket: "aether-realms.firebasestorage.app",
            messagingSenderId: "745970771566",
            appId: "1:745970771566:web:1b0607362279665074a87f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const chatRef = ref(db, 'global_chat');

        // ‡ßß. ‡¶≤‡¶ï/‡¶Ü‡¶®‡¶≤‡¶ï ‡¶ö‡ßá‡¶ï
        const hasPlot = localStorage.getItem('hasPlot');
        const userName = localStorage.getItem('uName') || "Unknown Pirate";

        if(hasPlot === 'true'){
            document.getElementById('lockMessage').style.display = 'none';
            document.getElementById('iArea').style.display = 'block';
        }

        // ‡ß®. ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
        window.sendMsg = () => {
            const input = document.getElementById('msgInput');
            if(!input.value) return;

            push(chatRef, {
                name: userName,
                text: input.value,
                time: serverTimestamp()
            });
            input.value = '';
        };

        // ‡ß©. ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶∞‡¶ø‡ßü‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ (‡ßÆ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶∏‡¶π)
        onValue(chatRef, (snap) => {
            const cBox = document.getElementById('cBox');
            cBox.innerHTML = '';
            const eightHoursAgo = Date.now() - (8 * 60 * 60 * 1000);

            snap.forEach(child => {
                const data = child.val();
                // ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡ßÆ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
                if(data.time > eightHoursAgo) {
                    const date = new Date(data.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    cBox.innerHTML += `
                        <div class="msg-container">
                            <span class="u-time">${date}</span>
                            <span class="u-name">${data.name}:</span>
                            <span class="u-msg">${data.text}</span>
                        </div>
                    `;
                }
            });
            cBox.scrollTop = cBox.scrollHeight;
        });

        // ‡¶è‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶™‡¶≤‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶Ø‡¶æ‡¶¨‡ßá
        document.getElementById('msgInput').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') sendMsg();
        });
    </script>
</body>
</html>
