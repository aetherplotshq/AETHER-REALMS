<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESTATE CONTROLLER | K ARCHIVE</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { background: #fcfcfc; font-family: 'Times New Roman', serif; cursor: none; }
        
        .update-wrapper { 
            max-width: 550px; margin: 100px auto; padding: 60px; 
            background: #fff; border: 1px solid #f2f2f2; 
            box-shadow: 0 30px 60px rgba(0,0,0,0.03);
        }
        
        .update-wrapper h2 { 
            font-weight: 100; letter-spacing: 10px; text-align: center; 
            margin-bottom: 40px; font-size: 20px; text-transform: uppercase;
        }

        .input-group { margin-bottom: 25px; }
        label { 
            display: block; font-size: 9px; letter-spacing: 3px; 
            color: #9E7E45; margin-bottom: 10px; text-transform: uppercase; font-weight: bold;
        }

        input, select { 
            width: 100%; padding: 18px; border: 1px solid #eee; 
            background: #fafafa; outline: none; font-size: 13px;
            transition: 0.4s; font-family: inherit;
        }

        input:focus, select:focus { 
            border-color: #9E7E45; background: #fff;
        }

        .publish-btn { 
            width: 100%; padding: 22px; background: #000; color: #fff; 
            border: none; cursor: none; letter-spacing: 5px; 
            font-size: 11px; margin-top: 30px; text-transform: uppercase;
            transition: 0.5s;
        }

        .publish-btn:hover { background: #9E7E45; }

        .helper-text { font-size: 8px; color: #bbb; margin-top: 8px; letter-spacing: 1px; text-transform: uppercase; }

        #cursor-dot { position: fixed; width: 5px; height: 5px; background: #9E7E45; border-radius: 50%; pointer-events: none; z-index: 10000; transform: translate(-50%, -50%); }
        #cursor-outline { position: fixed; width: 30px; height: 30px; border: 1px solid #9E7E45; border-radius: 50%; pointer-events: none; z-index: 9999; transform: translate(-50%, -50%); transition: 0.2s; }
    </style>
</head>
<body>
    <div id="cursor-dot"></div>
    <div id="cursor-outline"></div>

    <header class="header" style="height: 80px; display: flex; align-items: center; justify-content: space-between; padding: 0 40px; border-bottom: 1px solid #eee;">
        <button onclick="history.back()" style="background:none; border:none; letter-spacing:2px; font-weight:bold; cursor:none; font-size: 10px;">← BACK</button>
        <div style="font-size:14px; letter-spacing:8px; font-weight: 900;">K</div>
        <div style="font-size:9px; letter-spacing:3px; color:#9E7E45; font-weight: bold;">ADMIN PORTAL</div>
    </header>

    <div class="update-wrapper">
        <h2>Estate Controller</h2>
        
        <div class="input-group">
            <label>Select Master Realm</label>
            <select id="realm-id" onchange="updatePlotLimits()">
                <optgroup label="Core Sections">
                    <option value="Millionaires">Millionaires Club (100 Plots)</option>
                    <option value="Social">Social Creators (100 Plots)</option>
                    <option value="Nations">World Nations (Global)</option>
                    <option value="Public">1 Million Grid (Bulk)</option>
                </optgroup>
                <optgroup label="Gaming Realm (105 Plots each)">
                    <option value="FF">Free Fire</option>
                    <option value="PUBG">PUBG Mobile</option>
                    <option value="MC">Minecraft</option>
                    <option value="GTA">GTA V</option>
                    <option value="VAL">Valorant</option>
                    <option value="COD">Call of Duty</option>
                    <option value="LOL">League of Legends</option>
                    <option value="AMONG">Among Us</option>
                    <option value="FORT">Fortnite</option>
                    <option value="FIFA">FIFA 26</option>
                    <option value="ROBLOX">Roblox</option>
                    <option value="GENSHIN">Genshin Impact</option>
                </optgroup>
            </select>
        </div>

        <div class="input-group">
            <label>Plot Identifier (Number)</label>
            <input type="number" id="plot-no" placeholder="e.g. 1 to 105">
            <p id="limit-hint" class="helper-text">Target the exact plot number in this realm.</p>
        </div>

        <div class="input-group">
            <label>Brand Logo URL (Direct Link)</label>
            <input type="text" id="logo-url" placeholder="https://i.ibb.co/logo.png">
            <p class="helper-text">Ensure the image is PNG or SVG for best quality.</p>
        </div>

        <div class="input-group">
            <label>Destination Authority (Link)</label>
            <input type="text" id="target-link" placeholder="https://t.me/username or website">
            <p class="helper-text">The URL this plot will redirect to when clicked.</p>
        </div>

        <button class="publish-btn" onclick="pushUpdate()">Execute Archive Update</button>
    </div>

    <script type="module">
        import { db, ref, set } from "./firebase-config.js";

        // কার্সার লজিক
        const dot = document.getElementById('cursor-dot');
        const outline = document.getElementById('cursor-outline');
        document.addEventListener('mousemove', (e) => {
            dot.style.left = e.clientX + 'px';
            dot.style.top = e.clientY + 'px';
            outline.animate({ left: `${e.clientX}px`, top: `${e.clientY}px` }, { duration: 500, fill: "forwards" });
        });

        // প্লট লিমিট দেখানোর ফাংশন (হিসাব ঠিক রাখার জন্য)
        window.updatePlotLimits = () => {
            const realm = document.getElementById('realm-id').value;
            const hint = document.getElementById('limit-hint');
            if (realm === "Public") hint.innerText = "Limit: 1 to 1,000,000";
            else hint.innerText = "Limit: 1 to 105 (Standard)";
        };

        window.pushUpdate = () => {
            const realm = document.getElementById('realm-id').value;
            const plotId = document.getElementById('plot-no').value;
            const logo = document.getElementById('logo-url').value;
            const link = document.getElementById('target-link').value;

            if(!plotId || !logo || !link) {
                alert("ERROR: All data fields must be populated to maintain integrity.");
                return;
            }

            // সুনির্দিষ্ট পাথে ডাটা সেভ করা (একুরেট হিসাবের জন্য)
            set(ref(db, `estate_data/${realm}/plot_${plotId}`), {
                logo: logo,
                link: link,
                updatedAt: new Date().toISOString()
            }).then(() => {
                alert(`SUCCESS: Plot #${plotId} in ${realm} is now live.`);
                // ফিল্ড রিসেট
                document.getElementById('plot-no').value = "";
                document.getElementById('logo-url').value = "";
                document.getElementById('target-link').value = "";
            }).catch((error) => {
                alert("FAILURE: Database connection error. Check Firebase Rules.");
                console.error(error);
            });
        };
    </script>
</body>
</html>
