<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SOCIAL HUB | K ARCHIVE</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { background: #fafafa; color: #111; overflow: hidden; font-family: 'Times New Roman', serif; cursor: none; }
        #cursor-dot { position: fixed; width: 5px; height: 5px; background: #9E7E45; border-radius: 50%; pointer-events: none; z-index: 10000; transform: translate(-50%, -50%); }
        #cursor-outline { position: fixed; width: 30px; height: 30px; border: 1px solid #9E7E45; border-radius: 50%; pointer-events: none; z-index: 9999; transform: translate(-50%, -50%); transition: 0.15s; }
        .chat-container { max-width: 500px; margin: 90px auto; background: #fff; border: 1px solid #eee; height: 75vh; display: flex; flex-direction: column; }
        .chat-header { padding: 25px; border-bottom: 1px solid #f2f2f2; text-align: center; }
        .realm-badge { font-size: 8px; letter-spacing: 3px; color: #9E7E45; text-transform: uppercase; border: 1px solid #9E7E45; padding: 4px 12px; display: inline-block; }
        #chat-window { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 12px; }
        .msg { padding: 12px 18px; font-size: 13px; line-height: 1.5; max-width: 75%; border: 1px solid #f0f0f0; }
        .sent { background: #000; color: #fff; align-self: flex-end; }
        .received { background: #fff; align-self: flex-start; }
        .msg-time { font-size: 7px; margin-top: 5px; opacity: 0.4; display: block; }
        .chat-input-area { display: flex; padding: 15px; border-top: 1px solid #f2f2f2; }
        .chat-input-area input { flex: 1; border: none; outline: none; font-family: inherit; }
        .send-btn { background: #000; color: #fff; border: none; padding: 0 20px; cursor: none; font-size: 9px; letter-spacing: 1px; }
    </style>
</head>
<body>
    <div id="cursor-dot"></div><div id="cursor-outline"></div>
    <header class="header" style="height:70px; display:flex; align-items:center; justify-content:space-between; padding:0 40px; border-bottom:1px solid #eee;">
        <button onclick="history.back()" style="background:none; border:none; letter-spacing:2px; font-weight:bold; cursor:none;">‚Üê BACK</button>
        <div style="font-size:24px; font-weight:900;">K</div>
        <div style="font-size:9px; letter-spacing:3px; color:#9E7E45;">CREATOR HUB</div>
    </header>
    <div class="chat-container">
        <div class="chat-header"><div class="realm-badge">SOCIAL CREATORS</div></div>
        <div id="chat-window"></div>
        <div class="chat-input-area">
            <input type="text" id="user-msg" placeholder="Share your thoughts..." maxlength="150" onkeypress="if(event.key==='Enter') sendMessage()">
            <button class="send-btn" onclick="sendMessage()">SEND</button>
        </div>
    </div>
    <script type="module">
        import { db, ref, push, onValue, query, orderByChild, startAt, remove, get } from "./firebase-config.js";
        const chatWindow = document.getElementById('chat-window');
        const inputField = document.getElementById('user-msg');
        const FOUR_HOURS = 4 * 60 * 60 * 1000;
        const chatRef = ref(db, `chats/Social`);
        onValue(query(chatRef, orderByChild('timestamp'), startAt(Date.now() - FOUR_HOURS)), (snapshot) => {
            chatWindow.innerHTML = "";
            snapshot.forEach((child) => {
                const data = child.val();
                const side = data.senderID === localStorage.getItem('chat_uid') ? 'sent' : 'received';
                const div = document.createElement('div');
                div.className = `msg ${side}`;
                div.innerHTML = `${data.text} <span class="msg-time">${new Date(data.timestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>`;
                chatWindow.appendChild(div);
            });
            chatWindow.scrollTop = chatWindow.scrollHeight;
        });
        window.sendMessage = () => {
            const text = inputField.value.trim();
            if (!text) return;
            if (!localStorage.getItem('chat_uid')) localStorage.setItem('chat_uid', 's' + Math.floor(Math.random()*9999));
            push(chatRef, { text, senderID: localStorage.getItem('chat_uid'), timestamp: Date.now() });
            inputField.value = "";
        };
        setInterval(() => {
            const cutoff = Date.now() - FOUR_HOURS;
            get(chatRef).then(snap => snap.forEach(c => { if(c.val().timestamp < cutoff) remove(ref(db, `chats/Social/${c.key}`)); }));
        }, 60000);
        document.addEventListener('mousemove', (e) => {
            document.getElementById('cursor-dot').style.left = e.clientX + 'px';
            document.getElementById('cursor-dot').style.top = e.clientY + 'px';
            document.getElementById('cursor-outline').animate({ left: e.clientX+'px', top: e.clientY+'px' }, { duration: 500, fill: "forwards" });
        });
    </script>
</body>
</html>
