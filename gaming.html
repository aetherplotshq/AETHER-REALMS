<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GAMING REALM | K-REALMS</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="custom-cursor"></div>
    <header class="main-header">
        <button onclick="history.back()" style="background:none; border:none; color:var(--rr-gold); font-weight:bold;">← BACK</button>
        <div class="logo-center"><div class="rr-logo-box"><span class="k-up">K</span><span class="k-down">K</span></div></div>
        <div id="realm-name" style="color:var(--rr-gold); font-size:10px; letter-spacing:3px;">GAMING REALM</div>
    </header>

    <div class="map-wrapper" style="display:flex; flex-direction:column; align-items:center; padding-top:160px;">
        <div class="vip-section" id="vip-plots"></div>
        <div class="canvas-grid" id="canvas-plots"></div>
    </div>

    <a href="chat.html" class="floating-chat">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="Chat">
    </a>

    <script type="module">
        import { db, ref, onValue } from "./firebase-config.js";
        const g = new URLSearchParams(window.location.search).get('g') || "Gaming";
        document.getElementById('realm-name').innerText = g.toUpperCase() + " REALM";

        onValue(ref(db, `sold_plots/${g}`), (snapshot) => {
            const soldData = snapshot.val() || {};
            const vipDiv = document.getElementById('vip-plots');
            const canvasDiv = document.getElementById('canvas-plots');
            
            vipDiv.innerHTML = ""; canvasDiv.innerHTML = "";

            for(let i=1; i<=5; i++){
                const div = document.createElement('div');
                div.className = 'vip-plot';
                if(soldData[i]) {
                    div.innerHTML = `<img src="${soldData[i].logo}" style="width:100%; height:100%; object-fit:cover;">`;
                    div.onclick = () => window.open(soldData[i].link, '_blank');
                } else {
                    div.innerHTML = `<div class="stars">★★★★★</div><span>VIP #${i}</span><strong>AUCTION</strong>`;
                    div.onclick = () => location.href=`order.html?g=${g}&p=${i}&pr=Auction`;
                }
                vipContainer.appendChild(div);
            }

            for(let i=1; i<=100; i++){
                const pID = i + 5;
                const div = document.createElement('div'); div.className = 'plot-unit';
                if(soldData[pID]) {
                    div.innerHTML = `<img src="${soldData[pID].logo}" style="width:100%; height:100%; object-fit:cover;">`;
                    div.onclick = () => window.open(soldData[pID].link, '_blank');
                } else {
                    let price = (i <= 20) ? 1299 : (1099 - ((i - 21) * 10)); if(price < 150) price = 150;
                    div.innerHTML = `<span>#${pID}</span><strong>$${price}</strong>`;
                    div.onclick = () => location.href=`order.html?g=${g}&p=${pID}&pr=${price}`;
                }
                canvasDiv.appendChild(div);
            }
        });
    </script>
</body>
</html>
