<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MASTER ADMIN | K ARCHIVE</title>
    <style>
        :root { --gold: #FCD535; --bg: #0B0E11; --card: #1E2329; }
        body { font-family: sans-serif; background: var(--bg); color: #fff; padding: 20px; display: none; }
        .container { max-width: 1100px; margin: 0 auto; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 10px; border: 1px solid #333; margin-bottom: 20px; }
        h2 { color: var(--gold); font-size: 16px; border-bottom: 1px solid #333; padding-bottom: 10px; margin-top: 0; }
        input { padding: 12px; width: 100%; margin-bottom: 10px; border: 1px solid #444; background: #0B0E11; color: #fff; border-radius: 4px; box-sizing: border-box; }
        .btn { padding: 10px 20px; cursor: pointer; border-radius: 5px; border: none; font-weight: bold; width: 100%; transition: 0.3s; }
        .btn-approve { background: #2ebd85; color: white; }
        .btn-manual { background: var(--gold); color: #000; margin-top: 10px; }
        .scroll { height: 400px; overflow-y: auto; }
        .live-item { padding: 10px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>
    <script>
        // পাসওয়ার্ড সেশন ম্যানেজমেন্ট
        const MASTER_PASS = "zoomlink34@gmail.com";
        if (!sessionStorage.getItem("is_admin")) {
            if (prompt("Master Access Password:") === MASTER_PASS) {
                sessionStorage.setItem("is_admin", "true");
                document.body.style.display = "block";
            } else {
                alert("ভুল পাসওয়ার্ড!");
                window.location.href = "index.html";
            }
        } else {
            document.body.style.display = "block";
        }
    </script>

    <div class="container">
        <h1 style="text-align: center; color: var(--gold); letter-spacing: 3px;">MILLIONAIRE ADMIN CENTER</h1>
        
        <div class="grid">
            <div class="card">
                <h2>Pending Approvals (Orders)</h2>
                <div id="order-list" class="scroll">অর্ডার চেক করা হচ্ছে...</div>
            </div>

            <div class="right-col">
                <div class="card">
                    <h2>Direct Manual Publish</h2>
                    <input type="number" id="mPlot" placeholder="Plot ID (1-100)">
                    <input type="text" id="mBrand" placeholder="Brand Name">
                    <input type="text" id="mImg" placeholder="Logo Link (URL)">
                    <input type="text" id="mWeb" placeholder="Social/Web Link">
                    <button class="btn btn-manual" onclick="manualUpdate()">LIVE NOW</button>
                </div>

                <div class="card">
                    <h2>Live Map Data (Clear Plots)</h2>
                    <div id="liveRecords" class="scroll">লোড হচ্ছে...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <script>
        const config = {
            apiKey: "AIzaSyCAdnfu2R82xbC7H85n_9mvQBE58X3TjbA",
            authDomain: "the-5k-elite-legacy.firebaseapp.com",
            databaseURL: "https://the-5k-elite-legacy-default-rtdb.firebaseio.com",
            projectId: "the-5k-elite-legacy",
            appId: "1:440824313752:web:2c93344dcfe2ba0a4c5ded"
        };
        firebase.initializeApp(config);
        const db = firebase.database();

        // ১. অর্ডার চেক করা (pixels অথবা pending_orders উভয় পাথই চেক করবে)
        db.ref('pending_orders/Millionaire').on('value', s => {
            const list = document.getElementById('order-list');
            list.innerHTML = "";
            const data = s.val();
            if(!data) {
                list.innerHTML = "<p style='color:#666'>কোন পেন্ডিং অর্ডার নেই।</p>";
                return;
            }
            Object.keys(data).forEach(key => {
                const o = data[key];
                list.innerHTML += `
                    <div class="card" style="background:#000; border:1px solid var(--gold);">
                        <b>Plot #${o.plotID} - ${o.brandName}</b><br><br>
                        <input type="text" id="img_${key}" placeholder="Logo URL">
                        <input type="text" id="web_${key}" placeholder="Social Link">
                        <button class="btn btn-approve" onclick="approve('${key}', '${o.plotID}', '${o.brandName}')">APPROVE</button>
                    </div>`;
            });
        });

        // এপ্রুভ লজিক
        function approve(key, pid, brand) {
            const img = document.getElementById('img_'+key).value;
            const web = document.getElementById('web_'+key).value;
            if(!img) return alert("Logo URL দিন!");
            
            // pixels পাথে লাইভ করা (ক্যানভাস এই পাথ ব্যবহার করে)
            db.ref('pixels/'+pid).set({
                plotID: pid, name: brand, imageUrl: img, link: web || "#"
            }).then(() => {
                db.ref('pending_orders/Millionaire/'+key).remove();
                alert("সফলভাবে লাইভ হয়েছে!");
            });
        }

        // ২. সরাসরি পাবলিশ
        function manualUpdate() {
            const pid = document.getElementById('mPlot').value, name = document.getElementById('mBrand').value,
                  img = document.getElementById('mImg').value, web = document.getElementById('mWeb').value;
            if(!pid || !name || !img) return alert("সব তথ্য দিন!");
            db.ref('pixels/'+pid).set({plotID: pid, name: name, imageUrl: img, link: web || "#"}).then(() => alert("Live!"));
        }

        // ৩. লাইভ ডাটা ডিলিট
        db.ref('pixels').on('value', s => {
            const list = document.getElementById('liveRecords'); list.innerHTML = "";
            const data = s.val(); if(!data) return list.innerHTML = "ম্যাপ ফাঁকা।";
            Object.keys(data).forEach(id => {
                list.innerHTML += `<div class="live-item">
                    <span>#${id} - ${data[id].name}</span>
                    <button onclick="db.ref('pixels/${id}').remove()" style="color:red; background:none; border:none; cursor:pointer;">DELETE</button>
                </div>`;
            });
        });
    </script>
</body>
</html>
