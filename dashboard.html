<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>WAR MAP</title><link rel="stylesheet" href="style.css"></head><body>
<nav style="padding:15px 30px; display:flex; justify-content:space-between; align-items:center; background:rgba(0,0,0,0.9); border-bottom:1px solid var(--gold);">
    <button onclick="location.href='index.html'" class="nav-btn">EXIT MAP</button>
    <h2 id="realmName" style="color:gold; font-family:'Cinzel Decorative'; margin:0; font-size:1.5rem;"></h2>
    <button onclick="location.href='support.html'" class="nav-btn">LEVEL UP</button>
</nav>

<div style="padding:40px 20px; text-align:center;">
    <div id="kingdoms" style="display:flex; justify-content:center; gap:20px; margin-bottom:60px; flex-wrap:wrap;"></div>
    <div id="grid" style="display:grid; grid-template-columns: repeat(10, 1fr); gap:12px; max-width:1100px; margin:auto; padding-bottom:100px;"></div>
</div>

<div class="chat-box">
    <div style="background:var(--bronze); padding:12px; text-align:center; font-weight:bold; color:#000; font-family:sans-serif;">GHOST CHAT (LIVE)</div>
    <div id="messages"></div>
    <input type="text" id="chatInput" placeholder="Wait for Admin Approval..." disabled>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getDatabase, ref, onValue, push } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDmMgjlpXsk0Ip5Frrlifu6bgRJNNIIYzM",
        authDomain: "aether-realms.firebaseapp.com",
        databaseURL: "https://aether-realms-default-rtdb.firebaseio.com",
        projectId: "aether-realms",
        storageBucket: "aether-realms.firebasestorage.app",
        messagingSenderId: "745970771566",
        appId: "1:745970771566:web:1b0607362279665074a87f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const urlParams = new URLSearchParams(window.location.search);
    document.getElementById('realmName').innerText = urlParams.get('realm') || "REALM";

    // Global Chat Logic (সবার মেসেজ সবাই দেখবে)
    onValue(ref(db, 'global_chat'), (snap) => {
        const box = document.getElementById('messages');
        box.innerHTML = '';
        snap.forEach(child => {
            const d = child.val();
            box.innerHTML += `<div class="msg"><span class="msg-user">${d.name}</span><span class="msg-text">${d.text}</span></div>`;
        });
        box.scrollTop = box.scrollHeight;
    });

    // Chat Unlock Check (অ্যাডমিন লাইভ করলে খুলে যাবে)
    const myId = localStorage.getItem('myPlotId');
    if(myId) {
        onValue(ref(db, 'plots/' + myId), (snap) => {
            if(snap.val() && snap.val().status === 'active') {
                const inp = document.getElementById('chatInput');
                inp.disabled = false;
                inp.placeholder = "Type message, Captain...";
            }
        });
    }

    document.getElementById('chatInput').addEventListener('keypress', (e) => {
        if(e.key === 'Enter' && e.target.value != '') {
            push(ref(db, 'global_chat'), {
                name: localStorage.getItem('uName') || 'Pirate',
                text: e.target.value
            });
            e.target.value = '';
        }
    });

    // Map Generation
    const kings = [
        {id:'K4', c:'commander', p:599}, {id:'K2', c:'guardian', p:799},
        {id:'Leader', c:'leader', p:999},
        {id:'K3', c:'guardian', p:799}, {id:'K5', c:'commander', p:599}
    ];
    kings.forEach(k => {
        document.getElementById('kingdoms').innerHTML += `<div class="frame ${k.c}" style="width:130px; padding:20px;">
            <div style="font-size:40px;">☠️</div><div style="color:gold; font-size:18px;">$${k.p}</div><small>${k.id}</small>
        </div>`;
    });

    for(let i=1; i<=100; i++) {
        let rc = (i<=10)?'row-1':(i<=20)?'row-2':(i<=30)?'row-3':'';
        let pr = (i<=10)?299:(i<=20)?199:(i<=30)?99:29;
        document.getElementById('grid').innerHTML += `<div class="frame ${rc}" style="aspect-ratio:1/1; display:flex; flex-direction:column; align-items:center; justify-content:center; font-size:11px;">
            <span>#${i}</span><b style="color:gold;">$${pr}</b>
        </div>`;
    }
</script></body></html>
